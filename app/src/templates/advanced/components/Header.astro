---
/**
 * Advanced Template Header
 *
 * Minimal, unobtrusive navigation
 * Clean lines, subtle interactions
 */
import { useTranslations, getLocalizedPath, type Language, defaultLang } from '@i18n/index';
import { navItems as navItemsConfig } from '@data/navigation';

interface Props {
  lang?: Language;
}

const { lang = defaultLang } = Astro.props;
const t = useTranslations(lang);

const navItems = navItemsConfig
  .filter((item) => !item.hidden)
  .map((item) => ({
    label: t(item.labelKey),
    href: getLocalizedPath(item.href, lang),
  }));

const currentPath = Astro.url.pathname;
---

<header class="adv-header">
  <div class="adv-header__container advanced-container">
    <a href={getLocalizedPath('/', lang)} class="adv-header__logo">
      <span class="adv-header__logo-text">Tunadao</span>
      <span class="adv-header__logo-year">1998</span>
    </a>

    <nav class="adv-header__nav" aria-label="Navegacao principal">
      <ul class="adv-header__nav-list">
        {
          navItems.map((item) => (
            <li>
              <a
                href={item.href}
                class:list={['adv-header__nav-link', { 'is-active': currentPath === item.href }]}
                aria-current={currentPath === item.href ? 'page' : undefined}
              >
                {item.label}
              </a>
            </li>
          ))
        }
      </ul>
    </nav>

    <button class="adv-header__menu-btn" aria-label="Abrir menu" aria-expanded="false">
      <span class="adv-header__menu-line"></span>
      <span class="adv-header__menu-line"></span>
    </button>
  </div>

  <!-- Mobile menu -->
  <nav class="adv-header__mobile" aria-label="Menu mobile" aria-hidden="true">
    <ul class="adv-header__mobile-list">
      {
        navItems.map((item) => (
          <li>
            <a
              href={item.href}
              class:list={['adv-header__mobile-link', { 'is-active': currentPath === item.href }]}
            >
              {item.label}
            </a>
          </li>
        ))
      }
    </ul>
  </nav>
</header>

<style>
  .adv-header {
    position: sticky;
    top: 0;
    z-index: var(--z-sticky);
    background-color: var(--advanced-bg);
    border-bottom: 1px solid var(--advanced-border-subtle);
  }

  .adv-header__container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 5rem;
  }

  /* Logo */
  .adv-header__logo {
    display: flex;
    align-items: baseline;
    gap: 0.375rem;
    text-decoration: none;
    color: var(--advanced-text);
    transition: opacity 200ms ease;
  }

  .adv-header__logo:hover {
    opacity: 0.8;
  }

  .adv-header__logo-text {
    font-size: 1.25rem;
    font-weight: 300;
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }

  .adv-header__logo-year {
    font-size: 0.75rem;
    color: var(--advanced-accent);
    font-weight: 500;
  }

  /* Desktop Navigation */
  .adv-header__nav {
    display: none;
  }

  @media (min-width: 768px) {
    .adv-header__nav {
      display: block;
    }
  }

  .adv-header__nav-list {
    display: flex;
    gap: var(--space-1);
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .adv-header__nav-link {
    display: block;
    padding: var(--space-2) var(--space-4);
    font-size: 0.8125rem;
    font-weight: 400;
    color: var(--advanced-text-secondary);
    text-decoration: none;
    letter-spacing: 0.02em;
    text-transform: uppercase;
    position: relative;
    transition: color 200ms ease;
  }

  .adv-header__nav-link::after {
    content: '';
    position: absolute;
    bottom: 0.25rem;
    left: var(--space-4);
    right: var(--space-4);
    height: 1px;
    background-color: var(--advanced-accent);
    transform: scaleX(0);
    transform-origin: right;
    transition: transform 300ms ease;
  }

  .adv-header__nav-link:hover {
    color: var(--advanced-text);
  }

  .adv-header__nav-link:hover::after {
    transform: scaleX(1);
    transform-origin: left;
  }

  .adv-header__nav-link.is-active {
    color: var(--advanced-accent);
  }

  .adv-header__nav-link.is-active::after {
    transform: scaleX(1);
  }

  /* Mobile menu button */
  .adv-header__menu-btn {
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 6px;
    width: 40px;
    height: 40px;
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 8px;
  }

  @media (min-width: 768px) {
    .adv-header__menu-btn {
      display: none;
    }
  }

  .adv-header__menu-line {
    display: block;
    width: 24px;
    height: 1px;
    background-color: var(--advanced-text);
    transition:
      transform 200ms ease,
      opacity 200ms ease;
  }

  .adv-header__menu-btn[aria-expanded='true'] .adv-header__menu-line:first-child {
    transform: rotate(45deg) translate(2px, 2px);
  }

  .adv-header__menu-btn[aria-expanded='true'] .adv-header__menu-line:last-child {
    transform: rotate(-45deg) translate(2px, -2px);
  }

  /* Mobile menu */
  .adv-header__mobile {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background-color: var(--advanced-bg);
    border-bottom: 1px solid var(--advanced-border-subtle);
    padding: var(--space-4) 0;
    transform: translateY(-100%);
    opacity: 0;
    visibility: hidden;
    transition:
      transform 300ms ease,
      opacity 300ms ease,
      visibility 300ms ease;
  }

  .adv-header__mobile[aria-hidden='false'] {
    transform: translateY(0);
    opacity: 1;
    visibility: visible;
  }

  @media (min-width: 768px) {
    .adv-header__mobile {
      display: none;
    }
  }

  .adv-header__mobile-list {
    list-style: none;
    padding: 0 var(--space-6);
    margin: 0;
  }

  .adv-header__mobile-link {
    display: block;
    padding: var(--space-3) 0;
    font-size: 1rem;
    font-weight: 400;
    color: var(--advanced-text-secondary);
    text-decoration: none;
    letter-spacing: 0.02em;
    border-bottom: 1px solid var(--advanced-border-subtle);
    transition: color 200ms ease;
  }

  .adv-header__mobile-link:hover,
  .adv-header__mobile-link.is-active {
    color: var(--advanced-accent);
  }

  .adv-header__mobile-list li:last-child .adv-header__mobile-link {
    border-bottom: none;
  }
</style>

<script>
  const menuBtn = document.querySelector('.adv-header__menu-btn');
  const mobileMenu = document.querySelector('.adv-header__mobile');

  if (menuBtn && mobileMenu) {
    menuBtn.addEventListener('click', () => {
      const isExpanded = menuBtn.getAttribute('aria-expanded') === 'true';
      menuBtn.setAttribute('aria-expanded', String(!isExpanded));
      mobileMenu.setAttribute('aria-hidden', String(isExpanded));
    });
  }
</script>
