---
/**
 * Mashup Template Header
 *
 * Heritage-inspired navigation blending Advanced's clean structure
 * with Experimental's bold typography touches.
 * Features: serif logo, monospace year accent, gold underline hovers
 */
import { useTranslations, getLocalizedPath, type Language, defaultLang } from '@i18n/index';
import { navItems as navItemsConfig } from '@data/navigation';
import { getDevPreviewHref } from '@templates/core';

interface Props {
  lang?: Language;
}

const { lang = defaultLang } = Astro.props;
const t = useTranslations(lang);
const currentPath = Astro.url.pathname;

const navItems = navItemsConfig
  .filter((item) => !item.hidden)
  .map((item) => ({
    label: t(item.labelKey),
    href: getDevPreviewHref(getLocalizedPath(item.href, lang), currentPath),
  }));

const logoHref = getDevPreviewHref(getLocalizedPath('/', lang), currentPath);
---

<header class="mash-header">
  <div class="mash-header__container mash-container">
    <!-- Logo: serif font with monospace year -->
    <a href={logoHref} class="mash-header__logo">
      <span class="mash-header__logo-text">Tunad√£o</span>
      <span class="mash-header__logo-divider" aria-hidden="true"></span>
      <span class="mash-header__logo-year">1998</span>
    </a>

    <!-- Desktop Navigation -->
    <nav class="mash-header__nav" aria-label="Navegacao principal">
      <ul class="mash-header__nav-list">
        {
          navItems.map((item) => (
            <li>
              <a
                href={item.href}
                class:list={['mash-header__nav-link', { 'is-active': currentPath === item.href }]}
                aria-current={currentPath === item.href ? 'page' : undefined}
              >
                {item.label}
              </a>
            </li>
          ))
        }
      </ul>
    </nav>

    <!-- Mobile menu button -->
    <button class="mash-header__menu-btn" aria-label="Abrir menu" aria-expanded="false">
      <span class="mash-header__menu-line"></span>
      <span class="mash-header__menu-line"></span>
    </button>
  </div>

  <!-- Mobile menu -->
  <nav class="mash-header__mobile" aria-label="Menu mobile" aria-hidden="true">
    <ul class="mash-header__mobile-list">
      {
        navItems.map((item) => (
          <li>
            <a
              href={item.href}
              class:list={['mash-header__mobile-link', { 'is-active': currentPath === item.href }]}
            >
              {item.label}
            </a>
          </li>
        ))
      }
    </ul>
  </nav>
</header>

<style>
  .mash-header {
    position: sticky;
    top: 0;
    z-index: var(--z-sticky, 40);
    background-color: var(--mash-bg);
    border-bottom: 1px solid var(--mash-border-subtle);
  }

  .mash-header__container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 4.5rem;
  }

  /* Logo - serif with heritage feel */
  .mash-header__logo {
    display: flex;
    align-items: baseline;
    gap: 0.625rem;
    text-decoration: none;
    color: var(--mash-text);
    transition: opacity var(--mash-transition-medium);
  }

  .mash-header__logo:hover {
    opacity: 0.85;
  }

  .mash-header__logo-text {
    font-family: var(--mash-font-display);
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: -0.01em;
  }

  .mash-header__logo-divider {
    width: 1px;
    height: 1.125rem;
    background-color: var(--mash-accent-muted);
    opacity: 0.5;
  }

  .mash-header__logo-year {
    font-family: var(--mash-font-mono);
    font-size: 0.6875rem;
    color: var(--mash-accent);
    letter-spacing: var(--mash-letter-spacing-wide);
  }

  /* Desktop Navigation */
  .mash-header__nav {
    display: none;
  }

  @media (min-width: 768px) {
    .mash-header__nav {
      display: block;
    }
  }

  .mash-header__nav-list {
    display: flex;
    gap: 0.25rem;
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .mash-header__nav-link {
    display: block;
    padding: 0.5rem 1rem;
    font-size: 0.8125rem;
    font-weight: 500;
    color: var(--mash-text-secondary);
    text-decoration: none;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    position: relative;
    transition: color var(--mash-transition-medium);
  }

  .mash-header__nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 1rem;
    right: 1rem;
    height: 2px;
    background: linear-gradient(90deg, var(--mash-accent), var(--mash-accent-light));
    transform: scaleX(0);
    transform-origin: right;
    transition: transform 300ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  .mash-header__nav-link:hover {
    color: var(--mash-text);
  }

  .mash-header__nav-link:hover::after {
    transform: scaleX(1);
    transform-origin: left;
  }

  .mash-header__nav-link.is-active {
    color: var(--mash-accent);
  }

  .mash-header__nav-link.is-active::after {
    transform: scaleX(1);
  }

  /* Mobile menu button */
  .mash-header__menu-btn {
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 6px;
    width: 40px;
    height: 40px;
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 8px;
  }

  @media (min-width: 768px) {
    .mash-header__menu-btn {
      display: none;
    }
  }

  .mash-header__menu-line {
    display: block;
    width: 24px;
    height: 2px;
    background-color: var(--mash-accent);
    transition:
      transform 200ms ease,
      opacity 200ms ease;
  }

  .mash-header__menu-btn[aria-expanded='true'] .mash-header__menu-line:first-child {
    transform: rotate(45deg) translate(3px, 3px);
  }

  .mash-header__menu-btn[aria-expanded='true'] .mash-header__menu-line:last-child {
    transform: rotate(-45deg) translate(3px, -3px);
  }

  /* Mobile menu */
  .mash-header__mobile {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background-color: var(--mash-bg);
    border-bottom: 1px solid var(--mash-border-subtle);
    padding: var(--mash-space-sm) 0;
    transform: translateY(-100%);
    opacity: 0;
    visibility: hidden;
    transition:
      transform 300ms ease,
      opacity 300ms ease,
      visibility 300ms ease;
  }

  .mash-header__mobile[aria-hidden='false'] {
    transform: translateY(0);
    opacity: 1;
    visibility: visible;
  }

  @media (min-width: 768px) {
    .mash-header__mobile {
      display: none;
    }
  }

  .mash-header__mobile-list {
    list-style: none;
    padding: 0 1.5rem;
    margin: 0;
  }

  .mash-header__mobile-link {
    display: block;
    padding: 0.875rem 0;
    font-family: var(--mash-font-display);
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--mash-text-secondary);
    text-decoration: none;
    border-bottom: 1px solid var(--mash-border-subtle);
    transition: color var(--mash-transition-medium);
  }

  .mash-header__mobile-link:hover,
  .mash-header__mobile-link.is-active {
    color: var(--mash-accent);
  }

  .mash-header__mobile-list li:last-child .mash-header__mobile-link {
    border-bottom: none;
  }
</style>

<script>
  const menuBtn = document.querySelector('.mash-header__menu-btn');
  const mobileMenu = document.querySelector('.mash-header__mobile');

  if (menuBtn && mobileMenu) {
    menuBtn.addEventListener('click', () => {
      const isExpanded = menuBtn.getAttribute('aria-expanded') === 'true';
      menuBtn.setAttribute('aria-expanded', String(!isExpanded));
      mobileMenu.setAttribute('aria-hidden', String(isExpanded));
    });
  }
</script>
