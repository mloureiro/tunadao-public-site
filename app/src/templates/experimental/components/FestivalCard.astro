---
/**
 * Experimental Template - FestivalCard (v2)
 * Horizontal row — not a card. Multiple rows stack to form a scannable list.
 * Desktop: poster (80px) + org logo (48px) + name/location + awards as text.
 * Mobile: poster (60px), logo hidden, stacked content.
 */
import ResponsiveImage from '@components/ResponsiveImage.astro';
import type { FrontendPalmaresFestival } from '@lib/cms/types';
import { sortAwards, extractPublicId } from '@lib/cms';

interface Props {
  festival: FrontendPalmaresFestival;
  organizerLabel?: string;
  participationLabel?: string;
}

const { festival, organizerLabel = 'Organização', participationLabel = 'Participação' } = Astro.props;

const sortedAwards = sortAwards(festival.awards);
const hasNoAwards = sortedAwards.length === 0;
const posterPublicId = festival.posterUrl ? extractPublicId(festival.posterUrl) : null;
---

<article class="exp-fest">
  <div class="exp-fest__row">
    {/* Poster thumbnail */}
    {festival.posterUrl && (
      <div class="exp-fest__poster">
        {posterPublicId ? (
          <ResponsiveImage
            publicId={posterPublicId}
            alt={`Cartaz ${festival.name}`}
            class="exp-fest__poster-img"
            sizes="80px"
            aspectRatio="3/4"
          />
        ) : (
          <img
            src={festival.posterUrl}
            alt={`Cartaz ${festival.name}`}
            class="exp-fest__poster-img"
            loading="lazy"
          />
        )}
      </div>
    )}

    {/* Organizer logo — desktop only */}
    {festival.organizingTuna && (
      <div class="exp-fest__logo" title={`${organizerLabel}: ${festival.organizingTuna.fullName}`}>
        {festival.organizingTuna.logoUrl ? (
          <img
            src={festival.organizingTuna.logoUrl}
            alt={festival.organizingTuna.shortName}
            loading="lazy"
          />
        ) : (
          <span class="exp-fest__logo-initial">
            {festival.organizingTuna.shortName.charAt(0)}
          </span>
        )}
      </div>
    )}

    {/* Festival info */}
    <div class="exp-fest__info">
      <span class="exp-fest__name">{festival.name}</span>
      <span class="exp-fest__location">{festival.location}</span>
      <span class="exp-fest__awards">
        {hasNoAwards
          ? participationLabel
          : sortedAwards.map((a) => a.name).join(', ')}
      </span>
    </div>
  </div>
</article>

<style>
  .exp-fest {
    background: var(--exp-bg-elevated);
    border-bottom: 1px solid var(--exp-border);
  }

  .exp-fest:last-child {
    border-bottom: none;
  }

  .exp-fest__row {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: var(--exp-space-sm) var(--exp-space-md);
  }

  /* Poster: 80px wide */
  .exp-fest__poster {
    width: 80px;
    flex-shrink: 0;
    overflow: hidden;
    border-radius: 2px;
    background: var(--exp-bg-surface);
  }

  .exp-fest__poster-img,
  .exp-fest__poster :global(img) {
    width: 100%;
    height: auto;
    display: block;
    object-fit: cover;
  }

  /* Org logo: 48px */
  .exp-fest__logo {
    width: 48px;
    height: 48px;
    flex-shrink: 0;
    overflow: hidden;
    border-radius: 4px;
    background: var(--exp-bg-surface);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .exp-fest__logo img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    padding: 3px;
  }

  .exp-fest__logo-initial {
    font-family: var(--exp-font-display);
    font-size: 0.9rem;
    font-weight: 700;
    color: var(--exp-accent);
  }

  /* Info block */
  .exp-fest__info {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 0.2em;
  }

  .exp-fest__name {
    font-family: var(--exp-font-body);
    font-size: 0.95rem;
    font-weight: 700;
    color: var(--exp-text);
    line-height: 1.3;
  }

  .exp-fest__location {
    font-family: var(--exp-font-body);
    font-size: 0.8rem;
    color: var(--exp-text-muted);
  }

  .exp-fest__awards {
    font-family: var(--exp-font-body);
    font-size: 0.8rem;
    color: var(--exp-text-muted);
    line-height: 1.4;
    margin-top: 0.15em;
  }

  /* Mobile */
  @media (max-width: 767px) {
    .exp-fest__poster {
      width: 60px;
    }

    .exp-fest__logo {
      display: none;
    }

    .exp-fest__row {
      padding: var(--exp-space-xs) var(--exp-space-sm);
    }
  }
</style>
