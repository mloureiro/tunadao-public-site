---
/**
 * DesignThemeToggle - Switch between design themes (classic/noite)
 * This controls structural/layout changes, separate from light/dark color mode.
 */
interface Props {
  /** Show labels next to icons */
  showLabels?: boolean;
}

const { showLabels = false } = Astro.props;

import { Icon as AstroIcon } from 'astro-icon/components';
---

<div class="design-toggle" data-show-labels={showLabels}>
  <button
    class="design-toggle__option design-toggle__option--classic"
    data-design="classic"
    aria-label="Classic theme"
    title="Classic - Traditional style"
  >
    <AstroIcon name="lucide:layout-dashboard" size={18} aria-hidden="true" />
    {showLabels && <span>Classic</span>}
  </button>
  <button
    class="design-toggle__option design-toggle__option--noite"
    data-design="noite"
    aria-label="Noite theme"
    title="Noite - Modern dark style"
  >
    <AstroIcon name="lucide:moon" size={18} aria-hidden="true" />
    {showLabels && <span>Noite</span>}
  </button>
</div>

<style>
  .design-toggle {
    display: inline-flex;
    gap: var(--space-1);
    padding: var(--space-1);
    background-color: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
  }

  .design-toggle__option {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-2);
    background: transparent;
    border: none;
    border-radius: var(--radius-md);
    color: var(--color-text-muted);
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .design-toggle__option :global(svg) {
    width: 18px;
    height: 18px;
  }

  .design-toggle__option span {
    font-size: var(--font-size-sm);
    font-weight: 500;
  }

  .design-toggle__option:hover {
    color: var(--color-text);
    background-color: var(--color-surface-hover);
  }

  .design-toggle__option--active {
    color: var(--color-primary);
    background-color: var(--color-primary-light);
  }

  .design-toggle__option:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }

  /* Labels hidden by default on small screens */
  .design-toggle__option span {
    display: none;
  }

  .design-toggle[data-show-labels='true'] .design-toggle__option span {
    display: inline;
  }

  @media (min-width: 640px) {
    .design-toggle__option {
      padding: var(--space-2) var(--space-3);
    }
  }
</style>

<script>
  (function () {
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    const ENV_DESIGN_THEME = (import.meta as any).env?.PUBLIC_DESIGN_THEME;

    function initDesignToggle() {
      const toggle = document.querySelector('.design-toggle');
      if (!toggle) return;

      const buttons = toggle.querySelectorAll('.design-toggle__option');

      // Get current design theme
      const getDesignTheme = (): 'classic' | 'noite' => {
        // 1. Check env var override
        if (ENV_DESIGN_THEME === 'classic' || ENV_DESIGN_THEME === 'noite') {
          return ENV_DESIGN_THEME;
        }
        // 2. Check localStorage
        const stored = localStorage.getItem('design-theme');
        if (stored === 'classic' || stored === 'noite') return stored;
        // 3. Default to classic
        return 'classic';
      };

      // Apply design theme
      const applyDesignTheme = (theme: 'classic' | 'noite') => {
        document.documentElement.setAttribute('data-design', theme);
        localStorage.setItem('design-theme', theme);
        updateButtons(theme);
      };

      // Update button states
      const updateButtons = (activeTheme: string) => {
        buttons.forEach((btn) => {
          const btnTheme = btn.getAttribute('data-design');
          btn.classList.toggle('design-toggle__option--active', btnTheme === activeTheme);
          btn.setAttribute('aria-pressed', btnTheme === activeTheme ? 'true' : 'false');
        });
      };

      // Initialize
      const initialTheme = getDesignTheme();
      applyDesignTheme(initialTheme);

      // Handle clicks
      buttons.forEach((btn) => {
        btn.addEventListener('click', () => {
          const theme = btn.getAttribute('data-design') as 'classic' | 'noite';
          applyDesignTheme(theme);
        });
      });
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initDesignToggle);
    } else {
      initDesignToggle();
    }
  })();
</script>
