---
import { Icon } from '@ui/icons';
---

<button class="theme-toggle" aria-label="Alternar modo escuro" title="Alternar modo escuro">
  <Icon name="sun" size={20} class="theme-toggle__icon theme-toggle__icon--sun" />
  <Icon name="moon" size={20} class="theme-toggle__icon theme-toggle__icon--moon" />
</button>

<style>
  .theme-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: var(--radius-md);
    background: transparent;
    color: var(--color-text-muted);
    transition:
      background-color var(--transition-fast),
      color var(--transition-fast);
  }

  .theme-toggle:hover {
    background-color: var(--color-surface-hover);
    color: var(--color-text);
  }

  .theme-toggle__icon {
    transition:
      transform var(--transition-fast),
      opacity var(--transition-fast);
  }

  :global(.theme-toggle__icon--sun) {
    display: block;
  }

  :global(.theme-toggle__icon--moon) {
    display: none;
  }

  :global([data-theme='dark'] .theme-toggle__icon--sun) {
    display: none;
  }

  :global([data-theme='dark'] .theme-toggle__icon--moon) {
    display: block;
  }
</style>

<script>
  // Theme toggle functionality
  const themeToggle = document.querySelector('.theme-toggle');

  // Get initial theme
  const getTheme = (): 'light' | 'dark' => {
    const stored = localStorage.getItem('theme');
    if (stored === 'dark' || stored === 'light') return stored;
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  };

  // Apply theme
  const applyTheme = (theme: 'light' | 'dark') => {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
  };

  // Initialize
  applyTheme(getTheme());

  // Toggle
  themeToggle?.addEventListener('click', () => {
    const current = document.documentElement.getAttribute('data-theme');
    applyTheme(current === 'dark' ? 'light' : 'dark');
  });

  // Listen for system preference changes
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
    if (!localStorage.getItem('theme')) {
      applyTheme(e.matches ? 'dark' : 'light');
    }
  });
</script>
