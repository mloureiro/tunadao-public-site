---
import Layout from '@layouts/Layout.astro';
import Button from '@components/Button.astro';
import HeroSection from '@components/HeroSection.astro';
import CategoryFilter from '@components/CategoryFilter.astro';
import VideoCard from '@components/videos/VideoCard.astro';
import VideoModal from '@components/videos/VideoModal.astro';
import Icon from '@ui/icons/Icon.astro';
import { useTranslations, type Language, defaultLang } from '@i18n/index';
import { getVideos } from '@lib/cms';

export function getStaticPaths() {
  return [{ params: { lang: undefined } }, { params: { lang: 'en' } }];
}

const { lang } = Astro.params;
const currentLang: Language = (lang as Language) || defaultLang;
const t = useTranslations(currentLang);

// Fetch videos from CMS (with fallback)
const videos = await getVideos();

const categories = [
  { key: 'all', label: t('videos.categories.all') },
  { key: 'atuacao', label: t('videos.categories.atuacao') },
  { key: 'festival', label: t('videos.categories.festival') },
  { key: 'serenata', label: t('videos.categories.serenata') },
  { key: 'citadao', label: t('videos.categories.citadao') },
  { key: 'outro', label: t('videos.categories.outro') },
];
---

<Layout title={`${t('videos.title')} | TunadÃ£o 1998`} description={t('videos.description')}>
  <HeroSection title={t('videos.title')} subtitle={t('videos.subtitle')} />

  <CategoryFilter
    categories={categories}
    itemSelector=".video-card"
    categoryAttribute="data-category"
    ariaLabel={t('videos.filterByCategory') || 'Filter by category'}
  />

  <section class="videos">
    <div class="container">
      <div class="videos__grid">
        {videos.map((video) => (
          <VideoCard video={video} watchOnLabel={t('videos.watchOn')} />
        ))}
      </div>
      {videos.length === 0 && (
        <div class="videos__empty">
          <p>{t('common.noResults')}</p>
        </div>
      )}
    </div>
  </section>

  <section class="youtube-cta">
    <div class="container">
      <div class="youtube-cta__content">
        <Icon name="youtube" size={48} />
        <h2>{t('videos.youtubeCta.title')}</h2>
        <p>{t('videos.youtubeCta.description')}</p>
        <Button href="https://www.youtube.com/@TUNADAO1998" variant="primary" size="lg" target="_blank">
          {t('videos.youtubeCta.button')}
        </Button>
      </div>
    </div>
  </section>

  <VideoModal closeLabel={t('common.close')} />
</Layout>

<style>
  .videos {
    padding: var(--space-12) 0;
    background-color: var(--color-background);
  }

  .videos__grid {
    display: grid;
    gap: var(--space-6);
    grid-template-columns: repeat(1, 1fr);
  }

  @media (min-width: 768px) {
    .videos__grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .videos__grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  .videos__empty {
    text-align: center;
    padding: var(--space-12) 0;
    color: var(--color-text-muted);
  }

  .youtube-cta {
    padding: var(--space-12) 0;
    background: linear-gradient(135deg, var(--color-youtube), var(--color-youtube-dark));
    color: var(--color-text-inverted);
  }

  .youtube-cta__content {
    text-align: center;
    max-width: 600px;
    margin: 0 auto;
  }

  .youtube-cta__content svg {
    margin-bottom: var(--space-4);
  }

  .youtube-cta__content h2 {
    font-size: var(--text-3xl);
    font-weight: 700;
    margin-bottom: var(--space-3);
  }

  .youtube-cta__content p {
    font-size: var(--text-lg);
    opacity: 0.9;
    margin-bottom: var(--space-6);
  }
</style>
