---
import Layout from '@layouts/Layout.astro';
import Button from '@components/Button.astro';
import HeroSection from '@components/HeroSection.astro';
import AlbumCard from '@components/music/AlbumCard.astro';
import { useTranslations, type Language, defaultLang } from '@i18n/index';
import { getAlbums } from '@lib/cms';
import { Icon } from '@ui/icons';
import heroImage from '@assets/photos/performance-percussao.jpg';

export function getStaticPaths() {
  return [{ params: { lang: undefined } }, { params: { lang: 'en' } }];
}

const { lang } = Astro.params;
const currentLang: Language = (lang as Language) || defaultLang;
const t = useTranslations(currentLang);

// Fetch albums from CMS (with fallback)
const cmsAlbums = await getAlbums();

// Map CMS albums to template format, using translations for descriptions
const albums = cmsAlbums.map((album) => ({
  id: album.id,
  title: album.title,
  year: album.year,
  spotifyAlbumId: album.spotifyAlbumId,
  description:
    album.description ||
    (album.id === 'de-capa-bem-tracada'
      ? t('music.albumDescriptions.deCapaBemTracada')
      : album.id === 'por-ruelas-e-calcadas'
        ? t('music.albumDescriptions.porRuelasECalcadas')
        : ''),
  type: album.type,
}));
---

<Layout title={`${t('music.title')} | TunadÃ£o 1998`} description={t('music.description')}>
  <HeroSection
    title={t('music.title')}
    subtitle={t('music.subtitle')}
    backgroundImage={heroImage}
    backgroundAlt={t('music.heroAlt')}
    height="60vh"
  />

  <!-- Spotify CTA -->
  <section class="spotify-cta">
    <div class="container">
      <div class="spotify-cta__content">
        <Icon name="spotify" size={40} />
        <div class="spotify-cta__text">
          <p>{t('music.spotifyCta')}</p>
        </div>
        <Button
          href="https://open.spotify.com/artist/7HeYIxlV5Nb1KvZkBx00sH"
          variant="primary"
          size="lg"
          target="_blank"
        >
          {t('music.openOnSpotify')}
        </Button>
      </div>
    </div>
  </section>

  <!-- Albums Section -->
  <section class="albums">
    <div class="container">
      <h2 class="section-title">{t('music.albums')}</h2>
      <div class="albums__grid">
        {
          albums.map((album) => (
            <AlbumCard
              album={album}
              studioLabel={t('music.recordingTypes.studio')}
              liveLabel={t('music.recordingTypes.live')}
            />
          ))
        }
      </div>
    </div>
  </section>
</Layout>

<style>
  /* Spotify CTA */
  .spotify-cta {
    background-color: var(--color-spotify);
    padding: var(--space-6) 0;
  }

  .spotify-cta__content {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-4);
    flex-wrap: wrap;
    color: white;
  }

  .spotify-cta__text p {
    font-size: var(--text-lg);
    font-weight: 500;
    margin: 0;
  }

  /* Section Title */
  .section-title {
    font-size: var(--text-3xl);
    font-weight: 700;
    margin-bottom: var(--space-8);
    color: var(--color-text);
    text-align: center;
  }

  /* Albums Section */
  .albums {
    padding: var(--space-12) 0;
    background-color: var(--color-background);
  }

  .albums__grid {
    display: flex;
    flex-direction: column;
    gap: var(--space-10);
    max-width: 900px;
    margin: 0 auto;
  }
</style>
