---
import Layout from '@layouts/Layout.astro';
import HeroSection from '@components/HeroSection.astro';
import ContactForm from '@components/contact/ContactForm.astro';
import ContactInfo from '@components/contact/ContactInfo.astro';
import MapEmbed from '@components/contact/MapEmbed.astro';
import { useTranslations, type Language, defaultLang } from '@i18n/index';
import { getContactInfo } from '@lib/cms';

export function getStaticPaths() {
  return [{ params: { lang: undefined } }, { params: { lang: 'en' } }];
}

const { lang } = Astro.params;
const currentLang: Language = (lang as Language) || defaultLang;
const t = useTranslations(currentLang);

// Fetch contact info from CMS (with fallback)
const contactInfo = await getContactInfo();
---

<Layout title={`${t('contact.title')} | TunadÃ£o 1998`} description={t('contact.description')}>
  <HeroSection title={t('contact.title')} subtitle={t('contact.subtitle')} />

  <section class="contact">
    <div class="container">
      <div class="contact__grid">
        <ContactForm labels={{
          name: t('contact.form.name'),
          namePlaceholder: t('contact.form.namePlaceholder'),
          email: t('contact.form.email'),
          emailPlaceholder: t('contact.form.emailPlaceholder'),
          subject: t('contact.form.subject'),
          subjectPlaceholder: t('contact.form.subjectPlaceholder'),
          subjectOptions: {
            atuacao: t('contact.form.subjectOptions.atuacao'),
            citadao: t('contact.form.subjectOptions.citadao'),
            informacao: t('contact.form.subjectOptions.informacao'),
            recrutamento: t('contact.form.subjectOptions.recrutamento'),
            outro: t('contact.form.subjectOptions.outro'),
          },
          message: t('contact.form.message'),
          messagePlaceholder: t('contact.form.messagePlaceholder'),
          submit: t('contact.form.submit'),
          sending: t('contact.form.sending'),
          success: t('contact.form.success'),
          error: t('contact.form.error'),
        }} />

        <div class="contact__sidebar">
          <ContactInfo
            contactInfo={contactInfo}
            labels={{
              title: t('contact.info.title'),
              email: t('contact.info.email'),
              phone: t('contact.info.phone'),
              address: t('contact.info.address'),
              social: t('contact.social'),
            }}
          />
          <MapEmbed
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3022.5!2d-7.9136!3d40.6614!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xd2319b875f9d1e1%3A0x6b2e6c9f2a3d4e5f!2sTunad%C3%A3o%201998!5e0!3m2!1spt-PT!2spt!4v1705590000000"
            title={t('contact.mapTitle')}
          />
        </div>
      </div>
    </div>
  </section>
</Layout>

<style>
  .contact {
    padding: var(--space-12) 0;
    background-color: var(--color-background);
  }

  .contact__grid {
    display: grid;
    gap: var(--space-8);
    grid-template-columns: 1fr;
  }

  @media (min-width: 1024px) {
    .contact__grid {
      grid-template-columns: 1fr 400px;
    }
  }

  .contact__sidebar {
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
  }
</style>
