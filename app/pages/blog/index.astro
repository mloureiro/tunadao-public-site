---
import Layout from '@layouts/Layout.astro';
import Card from '@components/Card.astro';
import { t } from '@i18n/index';
import { getAllPosts } from '@data/blog-posts';

// Get posts from data file
const posts = getAllPosts();

const categories = ['Todos', 'Notícias', 'Eventos', 'Prémios'];

function formatDate(dateStr: string): string {
  const date = new Date(dateStr);
  return date.toLocaleDateString('pt-PT', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
}
---

<Layout
  title={`${t('blog.title')} | Tunadão 1998`}
  description="Blog da Tunadão 1998 - Notícias, eventos e novidades da tuna do Instituto Politécnico de Viseu."
>
  <!-- Hero Section -->
  <section class="hero">
    <div class="container">
      <h1 class="hero__title">{t('blog.title')}</h1>
      <p class="hero__subtitle">{t('blog.subtitle')}</p>
    </div>
  </section>

  <!-- Categories Filter -->
  <section class="categories">
    <div class="container">
      <div class="categories__list">
        {categories.map((category, index) => (
          <button
            class="category-btn"
            class:list={{ 'category-btn--active': index === 0 }}
            data-category={category.toLowerCase()}
          >
            {category}
          </button>
        ))}
      </div>
    </div>
  </section>

  <!-- Blog Posts Grid -->
  <section class="posts">
    <div class="container">
      <div class="posts__grid">
        {posts.map((post) => (
          <a href={`/blog/${post.slug}`} class="post-card">
            <div class="post-card__image">
              <div class="post-card__placeholder">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                  <circle cx="8.5" cy="8.5" r="1.5"></circle>
                  <polyline points="21 15 16 10 5 21"></polyline>
                </svg>
              </div>
              <span class="post-card__category">{post.category}</span>
            </div>
            <div class="post-card__content">
              <h2 class="post-card__title">{post.title}</h2>
              <p class="post-card__excerpt">{post.excerpt}</p>
              <div class="post-card__meta">
                <time datetime={post.date}>{formatDate(post.date)}</time>
                <span class="post-card__reading-time">
                  {post.readingTime} {t('blog.readingTime')}
                </span>
              </div>
            </div>
          </a>
        ))}
      </div>

      {posts.length === 0 && (
        <div class="posts__empty">
          <p>{t('common.noResults')}</p>
        </div>
      )}
    </div>
  </section>
</Layout>

<style>
  /* Hero Section */
  .hero {
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
    color: var(--color-text-inverted);
    padding: var(--space-12) 0;
    text-align: center;
  }

  .hero__title {
    font-size: var(--text-4xl);
    font-weight: 700;
    margin-bottom: var(--space-2);
  }

  .hero__subtitle {
    font-size: var(--text-xl);
    opacity: 0.9;
  }

  /* Categories */
  .categories {
    padding: var(--space-6) 0;
    background-color: var(--color-surface);
    border-bottom: 1px solid var(--color-border);
  }

  .categories__list {
    display: flex;
    gap: var(--space-2);
    flex-wrap: wrap;
    justify-content: center;
  }

  .category-btn {
    padding: var(--space-2) var(--space-4);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-full);
    background-color: transparent;
    color: var(--color-text);
    font-size: var(--text-sm);
    font-weight: 500;
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .category-btn:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
  }

  .category-btn--active {
    background-color: var(--color-primary);
    border-color: var(--color-primary);
    color: var(--color-text-inverted);
  }

  /* Posts Grid */
  .posts {
    padding: var(--space-12) 0;
    background-color: var(--color-background);
  }

  .posts__grid {
    display: grid;
    gap: var(--space-6);
    grid-template-columns: repeat(1, 1fr);
  }

  @media (min-width: 768px) {
    .posts__grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .posts__grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  .posts__empty {
    text-align: center;
    padding: var(--space-12) 0;
    color: var(--color-text-muted);
  }

  /* Post Card */
  .post-card {
    display: flex;
    flex-direction: column;
    background-color: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    overflow: hidden;
    text-decoration: none;
    color: inherit;
    transition: transform var(--transition-normal), box-shadow var(--transition-normal);
  }

  .post-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
  }

  .post-card__image {
    position: relative;
    aspect-ratio: 16 / 9;
    background-color: var(--color-background);
  }

  .post-card__placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    color: var(--color-text-muted);
    opacity: 0.5;
  }

  .post-card__category {
    position: absolute;
    top: var(--space-3);
    left: var(--space-3);
    padding: var(--space-1) var(--space-2);
    background-color: var(--color-primary);
    color: var(--color-text-inverted);
    font-size: var(--text-xs);
    font-weight: 500;
    border-radius: var(--radius-sm);
  }

  .post-card__content {
    padding: var(--space-4);
    display: flex;
    flex-direction: column;
    flex-grow: 1;
  }

  .post-card__title {
    font-size: var(--text-lg);
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: var(--space-2);
    line-height: 1.3;
  }

  .post-card__excerpt {
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    line-height: 1.6;
    flex-grow: 1;
    margin-bottom: var(--space-3);
  }

  .post-card__meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: var(--text-xs);
    color: var(--color-text-muted);
    padding-top: var(--space-3);
    border-top: 1px solid var(--color-border);
  }

  .post-card__reading-time {
    display: flex;
    align-items: center;
    gap: var(--space-1);
  }
</style>

<script>
  // Category filter functionality
  document.addEventListener('DOMContentLoaded', () => {
    const categoryBtns = document.querySelectorAll('.category-btn');
    const postCards = document.querySelectorAll('.post-card');

    categoryBtns.forEach((btn) => {
      btn.addEventListener('click', () => {
        // Update active state
        categoryBtns.forEach((b) => b.classList.remove('category-btn--active'));
        btn.classList.add('category-btn--active');

        const category = btn.getAttribute('data-category');

        // Filter posts
        postCards.forEach((card) => {
          const postCategory = card.querySelector('.post-card__category')?.textContent?.toLowerCase();
          if (category === 'todos' || postCategory === category) {
            (card as HTMLElement).style.display = 'flex';
          } else {
            (card as HTMLElement).style.display = 'none';
          }
        });
      });
    });
  });
</script>
